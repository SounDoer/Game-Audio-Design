<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Topic/A-Practice-of-Audio-Visualization-with-UE-Wwise" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">“音频可视化” UE &amp; Wwise 实践案例 | Game Audio Design</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://soundoer.com/Game-Audio-Design/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://soundoer.com/Game-Audio-Design/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://soundoer.com/Game-Audio-Design/Topic/A-Practice-of-Audio-Visualization-with-UE-Wwise"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="“音频可视化” UE &amp; Wwise 实践案例 | Game Audio Design"><meta data-rh="true" name="description" content="*"><meta data-rh="true" property="og:description" content="*"><link data-rh="true" rel="icon" href="/Game-Audio-Design/img/GAD_Logo.ico"><link data-rh="true" rel="canonical" href="https://soundoer.com/Game-Audio-Design/Topic/A-Practice-of-Audio-Visualization-with-UE-Wwise"><link data-rh="true" rel="alternate" href="https://soundoer.com/Game-Audio-Design/Topic/A-Practice-of-Audio-Visualization-with-UE-Wwise" hreflang="en"><link data-rh="true" rel="alternate" href="https://soundoer.com/Game-Audio-Design/zh-Hans/Topic/A-Practice-of-Audio-Visualization-with-UE-Wwise" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://soundoer.com/Game-Audio-Design/Topic/A-Practice-of-Audio-Visualization-with-UE-Wwise" hreflang="x-default"><link rel="stylesheet" href="/Game-Audio-Design/assets/css/styles.4a3518ac.css">
<script src="/Game-Audio-Design/assets/js/runtime~main.ada4d458.js" defer="defer"></script>
<script src="/Game-Audio-Design/assets/js/main.f3346f17.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Game-Audio-Design/img/GAD_Logo_Black.png"><link rel="preload" as="image" href="/Game-Audio-Design/img/GAD_Logo_White.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Game-Audio-Design/"><div class="navbar__logo"><img src="/Game-Audio-Design/img/GAD_Logo_Black.png" alt="GAD Horse Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Game-Audio-Design/img/GAD_Logo_White.png" alt="GAD Horse Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/Game-Audio-Design/">Course</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Game-Audio-Design/Topic/intro">Topic</a><a class="navbar__item navbar__link" href="/Game-Audio-Design/Resource">Resource</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Game-Audio-Design/Log">  </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/intro">Xichen&#x27;s Game Audio Design Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/Game-Audio-Design/Topic/A-Practice-of-Audio-Visualization-with-UE-Wwise">“音频可视化” UE &amp; Wwise 实践案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/A-Practice-of-Music-as-Level-Design-with-UE-Wwise">“音乐作为关卡设计” UE &amp; Wwise 实践案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/A-Procedural-Way-of-Melee-Weapon-Whoosh-Sound-Design">冷兵器 Procedural Whoosh 音频设计案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/A-Project-Case-of-Object-Based-Audio-Design-and-Mixing">Object-Based Audio 音频设计与混音案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/A-Thought-of-Designing-Sound-in-Game-Deconstruction-and-Modeling">游戏音频设计的一种思路：解构与建模</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/Audio-Design-Pipeline-of-Realtime-Cinematic-in-Object-Based-Audio">基于对象音频的游戏实时动画音频设计流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/Game-Audio-Designer-Technical-Audio-Designer-and-Audio-Programmer">游戏音频设计师、技术音频设计师和音频程序员</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/How-to-Search-Audio-Design-Information">如何搜索有关音频设计的资讯</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/Incomprehensive-Game-Audio-Design-Skillset">非全面的游戏音频设计技能树</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/Listener-Centered-Dynamic-Wind-Audio-Design">基于听者的动态风声设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/Microsoft-Project-Acoustics-Wave-Physics-Simulation-Playtest">Microsoft Project Acoustics 声波物理模拟测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/Preface">前言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/The-Workflow-of-Game-Audio-Design">游戏音频设计的工作流</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Game-Audio-Design/Topic/What-will-The-Next-Gen-of-Game-Audio-Design-be-like">展望游戏音频设计的发展方向</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Game-Audio-Design/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">“音频可视化” UE &amp; Wwise 实践案例</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>“音频可视化” UE &amp; Wwise 实践案例</h1></header>
<hr>
<ul>
<li><a href="#%E9%9F%B3%E9%A2%91%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9A%84%E5%85%83%E7%B4%A0">音频可视化的元素</a></li>
<li><a href="#%E7%BB%93%E5%90%88%E7%8E%B0%E6%9C%89%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">结合现有工具的实现思路</a></li>
<li><a href="#%E6%97%B6%E5%9F%9F%E5%A3%B0%E9%9F%B3%E5%8C%85%E7%BB%9Cenvelope">时域：声音包络（Envelope）</a></li>
<li><a href="#%E9%A2%91%E5%9F%9F%E5%A3%B0%E9%9F%B3%E9%A2%91%E8%B0%B1spectrum">频域：声音频谱（Spectrum）</a></li>
<li><a href="#%E6%97%B6%E5%9F%9F%E4%B8%8E%E9%A2%91%E5%9F%9F%E5%A3%B0%E9%9F%B3%E6%97%B6%E9%A2%91%E8%B0%B1spectrogram">时域与频域：声音时频谱（Spectrogram）</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<hr>
<p>继上一篇文章<a href="/Game-Audio-Design/Topic/A-Practice-of-Music-as-Level-Design-with-UE-Wwise">《“音乐作为关卡设计” UE &amp; Wwise 实践案例》</a>中运用音乐中的标记信息来触发游戏事件之后，我想在个人练习项目里想实现的下一个功能是用音乐中的信息来驱动视觉效果的表现，也就是通常说的音频可视化（Audio Visualization）。<br>
<!-- -->音频可视化本身是一个大课题，在数字艺术和现场表演等领域已经有了成熟的工具和艺术表达。本文不讨论艺术方面的表现效果，也不深究音频信号的数理定义，仅从基本概念入手，结合引擎工具 Unreal Engine 和音频中间件 Wwise 已有的功能，来实现一些基本的音频可视化效果。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">开发环境与工具：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unreal Engine 4.26 C++ &amp; Blueprint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Audiokinetic Wwise 2021.1.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="音频可视化的元素">音频可视化的元素<a href="#音频可视化的元素" class="hash-link" aria-label="Direct link to 音频可视化的元素" title="Direct link to 音频可视化的元素">​</a></h2>
<p>对于数字音频信号的分析，通常可以从<strong>时域</strong>（Time Domain）和<strong>频域</strong>（Frequency Domain）两个方面入手，相关的分析工具和表现形式在各类播放器和音频工具中其实都很常见。</p>
<p>简单来说，从时域上分析可以得知音频信号的能量大小随时间变化的情况，根据不同的计算与加权方式可以表示各种与能量相关的数值情况。比如，峰值（Peak）表现在声音波形（Waveform）上就是波形最外层的包络曲线（Envelope），响度（Loudness）表现在表头上就是实时变化的数值指示。</p>
<p><img decoding="async" loading="lazy" alt="Waveform &amp;amp; Meter" src="/Game-Audio-Design/assets/images/WaveformAndMeter-67f1032b62fffad28a85c47749bc7d2d.png" width="1920" height="1080" class="img_ev3q"></p>
<p>从频域上分析可以得知某一时刻音频信号的能量在频率上的分布情况，即常见的频谱图（Spectrum）所表示的各个频段在人耳可闻频谱范围内的能量大小。</p>
<p><img decoding="async" loading="lazy" alt="Spectrum" src="/Game-Audio-Design/assets/images/Spectrum-8aacee83e99a37a2ab8d8f5a924b3d6e.png" width="1920" height="1080" class="img_ev3q"></p>
<p>除此之外，还有一种将时域和频域信息整合在一起的可视化方式，即时频谱（Spectrogram），3D 形式的时频谱也因其立体形象而被叫做“瀑布图”。</p>
<p><img decoding="async" loading="lazy" alt="Spectrogram" src="/Game-Audio-Design/assets/images/Spectrogram-676db984c6ac3b6caa18b8fc822446fb.png" width="1920" height="1080" class="img_ev3q"></p>
<p>下文将以实现上述三种可视化效果来展开。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="结合现有工具的实现思路">结合现有工具的实现思路<a href="#结合现有工具的实现思路" class="hash-link" aria-label="Direct link to 结合现有工具的实现思路" title="Direct link to 结合现有工具的实现思路">​</a></h2>
<p>由于项目已有的音频功能都是基于中间件 Wwise 的，音频可视化的实现也需要统一在同一框架下，因此具体的实现方式也多了一些限制和要求：</p>
<ol>
<li>由于编程水平有限，尽量不考虑自己修改或重写代码的方式来实现；</li>
<li>据我了解，除了 Wwise Meter 插件之外，目前 Wwise 并没有直接与音频分析相关的功能，无法从 Wwise 中便捷地获取频谱相关的声音信息；</li>
<li>UE 引擎确实有不少与音频分析相关的功能，但需要在其自身的音频系统框架下使用，这样一来，声音资源的管理和控制都将与 Wwise 脱节，因此也不适用。</li>
</ol>
<p><img decoding="async" loading="lazy" alt="UE Blueprint Audio Visualization" src="/Game-Audio-Design/assets/images/UE_Blueprint_Overview-b87aea6b1b72d4aeadd75e0a70c1074c.png" width="1920" height="1080" class="img_ev3q"></p>
<p>所以，一种可行的实现思路是，利用 UE 引擎中的功能对声音文件进行分析并存储相应的数据，然后通过 Wwise 控制声音的播放并调用对应时刻的信息。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="时域声音包络envelope">时域：声音包络（Envelope）<a href="#时域声音包络envelope" class="hash-link" aria-label="Direct link to 时域：声音包络（Envelope）" title="Direct link to 时域：声音包络（Envelope）">​</a></h2>
<p>首先从相对简单的 Envelope 入手。从数据类型来看，音频信号在时域上的瞬时值可以理解为是一个随时间快速变化的浮点数变量，可以直接用来驱动视觉元素的各种参数；更进一步，可以将一段时间内的变量数值先存储进数组，然后用数组来驱动视觉元素的变化，这样就能表现出音频信号在一段时间内的 Envelope 形态。</p>
<p>如上一节实现思路中所提到的，想尽可能在 Wwise 框架下实现功能，而 Wwise Meter 插件正好可以满足这一要求。在中间件内 Audio Bus 上使用 Wwise Meter 插件来获取音频信号的时域瞬时值，然后映射到创建的 Game Parameter 上，最后在引擎中通过 GetRTPCValue 节点来获取该数值。</p>
<p><img decoding="async" loading="lazy" alt="Wwise Meter RTPC" src="/Game-Audio-Design/assets/images/Envelope_Wwise_Meter_RTPC-c4fbbff6371269d917d44eb238893676.png" width="1920" height="1080" class="img_ev3q"></p>
<p>在引擎中获取到该数值后，首先通过 MapRangeClamped 和 FInterpTo 节点对数据进行标准化和平滑处理。然后，将数据存入一个定长的浮点数数组中，数组长度可以根据需要展示的 Envelope 长度来决定。更新数组内数据的思路是，在每一次 Tick 时，最新的数值永远存储在数组的最开头位置，数组之后的位置依次复制前一位的数值，这样就能将一段时间内的数值变化存储下来并且持续进行更新。如果以每秒 60 帧的 Tick 速率来计算，长度为 60 的数组可以记录 1 秒内的数值变化。最后，就可以用该数组内的数据来同步驱动视觉元素的表现了。</p>
<p><img decoding="async" loading="lazy" alt="UE Update Envelope Line" src="/Game-Audio-Design/assets/images/Envelope_UE_UpdateEnvelopeLine-56e3af819a0701ccfd5ccaffe5735411.png" width="1920" height="1080" class="img_ev3q"></p>
<p>Envelope 效果如下动图。</p>
<p><img decoding="async" loading="lazy" alt="Audio Visualization Envelope Demo" src="/Game-Audio-Design/assets/images/Envelope_Demo-5faa76c397d2ee732229c240a0a7377c.gif" width="800" height="450" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="频域声音频谱spectrum">频域：声音频谱（Spectrum）<a href="#频域声音频谱spectrum" class="hash-link" aria-label="Direct link to 频域：声音频谱（Spectrum）" title="Direct link to 频域：声音频谱（Spectrum）">​</a></h2>
<p>从数据类型来看，音频信号在某一时刻的频谱信息可以理解为是一个浮点数数组，数组长度代表了频率范围，而其中各个位置上的数值可以看作是时域瞬时值在频域上的展开。用该数组驱动视觉元素的变化并不断更新，就可以表现音频信号的 Spectrum 形态。</p>
<p>目前 UE Audio Synesthesia 组件提供了三种音频分析工具 LoudnessNRT、ConstantQNRT 和 OnsetNRT，分别可以提取音频信号的响度、频谱和瞬态变化的信息。其中 NRT 的意思是非实时（Non Real Time），工作原理是将 Wav 音频文件导入引擎中并配置分析工具，分析得到的数据会被保存在相应的 NRT 对象中，获取当前音频信号的播放位置即可从 NRT 对象中读取对应时刻的信息。<br>
<!-- -->因此，可以使用 ConstantQNRT 分析工具来获取并保存音频信号的频谱信息。其中 ConstantQ 指的是信号处理中的<a href="https://en.wikipedia.org/wiki/Constant-Q_transform" target="_blank" rel="noopener noreferrer">常数Q变换</a>，与常见的傅里叶变化有关。具体有何区别我也讲不清，反正可以用来获取声音的频域信息就对了。</p>
<p>如下图，首先在引擎中创建 ConstantQNRT 对象，并在其中配置需要分析的音频文件。有需要的话，还可以创建 ConstantQNRT Setting 对象，进一步设置与频谱分析相关的各种参数。</p>
<p><img decoding="async" loading="lazy" alt="UE Audio Synesthesia" src="/Game-Audio-Design/assets/images/Spectrum_Synesthesia_ConstantQNRT_Object-74146ec15dda394c64b7afa8b66f1849.png" width="1920" height="1080" class="img_ev3q"></p>
<p>接下来，使用引擎原生的 Audio Component 来设置播放的音频文件并获取其时长，然后通过 OnAudioPlaybackPercent 事件来获取 Playback Percent，该数值与音频文件时长相乘即可得到以秒为单位的 Current Play Position，最后使用 GetNormalizedChannelConstantQAtTime 节点来读取 ConstantQNRT 中相应时刻的信息。</p>
<p><img decoding="async" loading="lazy" alt="UE Audio Synesthesia Native Audio Component" src="/Game-Audio-Design/assets/images/Spectrum_Synesthesia_NativeAudioComp-042dc210cf81769d998df543c013ab0b.png" width="1920" height="1080" class="img_ev3q"></p>
<p>以上，就是使用 UE 引擎原生组件来获取声音频谱信息的方式。如果要引入中间件 Wwise 来控制，只要能获取音频文件的当前播放位置就可以了。在<a href="/Game-Audio-Design/Topic/A-Practice-of-Music-as-Level-Design-with-UE-Wwise">《“音乐作为关卡设计” UE &amp; Wwise 实践案例》</a>的“获取当前播放位置信息”章节中，讲解了创建 GetSourcePlayPosition 函数从 PostAkEvent 节点的 Callback 信息中获取当前播放位置的方法，在这里直接使用这一函数节点就能从 Wwise 控制的音频文件中获取当前播放位置，然后仍旧可以使用 GetNormalizedChannelConstantQAtTime 节点来读取 ConstantQNRT 中相应时刻的数组信息了，最后用此数据来同步驱动视觉元素的表现。</p>
<p><img decoding="async" loading="lazy" alt="UE Audio Synesthesia Wwise Control" src="/Game-Audio-Design/assets/images/Spectrum_Synesthesia_WwiseControl-1f11382c8232d17c1a56583ab4d5a534.png" width="1920" height="1080" class="img_ev3q"></p>
<p>Spectrum 效果如下动图。</p>
<p><img decoding="async" loading="lazy" alt="Audio Visualization Spectrum Demo" src="/Game-Audio-Design/assets/images/Spectrum_Demo-3df1b446066b622be3605e580f9fa1dd.gif" width="800" height="450" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="时域与频域声音时频谱spectrogram">时域与频域：声音时频谱（Spectrogram）<a href="#时域与频域声音时频谱spectrogram" class="hash-link" aria-label="Direct link to 时域与频域：声音时频谱（Spectrogram）" title="Direct link to 时域与频域：声音时频谱（Spectrogram）">​</a></h2>
<p>在实现了 Envelope 和 Spectrum 之后，再来理解 Spectrogram 就简单多了。Spectrogram 可以看作是由 Envelope 和 Spectrum 两者构成的一个二维数组，或者形象地来看就是一个二维矩阵，其中 Envelope 一轴表示的是时域，Spectrum 表示的则是频域。</p>
<p>获取当前播放位置和对应时刻频谱数据的方法与上一节 Spectrum 类似，主要区别在于如何用 Spectrum 数组信息来生成和驱动视觉元素二维矩阵的变化。如下图，通过 SpawnSpectrogramMatrix 和 UpdateSpectrogram 两个函数节点来实现。</p>
<p><img decoding="async" loading="lazy" alt="UE BP Spectrogram Overview" src="/Game-Audio-Design/assets/images/Spectrogram_UE_Overview-350d1ba3a02a0cf3ed66457f8316ea51.png" width="1920" height="1080" class="img_ev3q"></p>
<p>在 SpawnSpectrogramMatrix 函数节点中，首先以 SpectrumBandNumber 为行长、SpectrogramLength 为列长来生成二维矩阵。其中 SpectrumBandNumber 对应的是从 ConstantQNRT 对象中获取到的单个 Spectrum 数据的数组长度，可以在 ConstantQNRT Setting 对象中设置；SpectrogramLength 表示的是同时展示的 Spectrum 数组的个数，数值越大则表现内容的时长越长。<br>
<!-- -->另外，在将生成的视觉元素存入数组的同时，需要将每一列最开始元素的索引值存入到 ColumnStartIndexArray 数组中，之后用来指示每一个 Spectrum 数组在矩阵中更新数据的起始位置。</p>
<p><img decoding="async" loading="lazy" alt="UE Spectrogram Matrix Initial" src="/Game-Audio-Design/assets/images/Spectrogram_SpectrogramMatrixInitial-7ba32e9561020dc9077da206c058c8b0.png" width="1920" height="1080" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="UE BP Spawn Spectrogram Matrix" src="/Game-Audio-Design/assets/images/Spectrogram_UE_SpawnSpectrogramMatrix-f59f3714be9035a812921ab53d4945d4.png" width="1920" height="1080" class="img_ev3q"></p>
<p>在 UpdateSpectrogram 函数节点中，遍历 ColumnStartIndexArray 数组并结合 SpectrumBandNumber 数值来找到每一列的起止范围；同时，以 CurrentPlayPosition 为基准、根据 ColumnStartIndexArray 中的索引值来对送入 GetNormalizedChannelConstantQAtTime 节点的 InSeconds 数值做偏差调整，这样就能从 ConstantQNRT 对象中获取一段时间内连续多个 Spectrum 数组的数据了。</p>
<p><img decoding="async" loading="lazy" alt="UE BP Update Spectrogram" src="/Game-Audio-Design/assets/images/Spectrogram_UE_UpdateSpectrogram-3933de9ad935100d0961176a4b6f6f74.png" width="1920" height="1080" class="img_ev3q"></p>
<p>Spectrogram 效果如下动图。</p>
<p><img decoding="async" loading="lazy" alt="Audio Visualization Spectrogram Demo" src="/Game-Audio-Design/assets/images/Spectrogram_Demo-3135c48ed8b4b89963a9021c16e15034.gif" width="800" height="450" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>上述方法只是在文章开头提出的要求与限制下取巧地实现了音频可视化的功能，从各个方面来评判都算不上是最优解。一个显而易见的问题就是，同一个音频文件需要在引擎和中间件中分别导入，一份用于数据分析，一份用于播放控制，如果文件数量很多的话，就会造成存储资源的浪费。<br>
<!-- -->所以，如果没有需要配合中间件的要求，大可以直接使用 UE 引擎的原生功能来实现简单的音频可视化功能；当然理想情况是，Wwise 自身能有更多音频分析相关的功能和与引擎进行数据通信的方式。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2>
<p><a href="https://docs.unrealengine.com/en-US/BlueprintAPI/Audio/Components/Audio/index.html" target="_blank" rel="noopener noreferrer">Unreal Engine Blueprint API Reference - Audio Component</a><br>
<a href="https://docs.unrealengine.com/en-US/BlueprintAPI/Audio/Analysis/index.html" target="_blank" rel="noopener noreferrer">Unreal Engine Blueprint API Reference - Audio Analysis</a><br>
<a href="https://docs.unrealengine.com/en-US/BlueprintAPI/AudioAnalyzer/index.html" target="_blank" rel="noopener noreferrer">Unreal Engine Blueprint API Reference - Audio Analyzer</a><br>
<a href="https://docs.unrealengine.com/en-US/BlueprintAPI/SoundVisualization/index.html" target="_blank" rel="noopener noreferrer">Unreal Engine Blueprint API Reference - Sound Visualization</a><br>
<a href="https://docs.unrealengine.com/en-US/BlueprintAPI/TimeSynth/index.html" target="_blank" rel="noopener noreferrer">Unreal Engine Blueprint API Reference - Time Synth</a><br>
<a href="https://docs.unrealengine.com/en-US/WorkingWithMedia/Audio/Synesthesia/index.html" target="_blank" rel="noopener noreferrer">Unreal Engine 4 Documentation - Audio Synesthesia</a><br>
<a href="https://www.audiokinetic.com/library/edge/?source=Help&amp;id=wwise_meter_plug_in_effect" target="_blank" rel="noopener noreferrer">Wwise Help - Wwise Meter</a></p>
<p>希辰<br>
<!-- -->2021.4.3</p>
<hr></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Game-Audio-Design/Topic/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Xichen&#x27;s Game Audio Design Document</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Game-Audio-Design/Topic/A-Practice-of-Music-as-Level-Design-with-UE-Wwise"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">“音乐作为关卡设计” UE &amp; Wwise 实践案例</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#音频可视化的元素" class="table-of-contents__link toc-highlight">音频可视化的元素</a></li><li><a href="#结合现有工具的实现思路" class="table-of-contents__link toc-highlight">结合现有工具的实现思路</a></li><li><a href="#时域声音包络envelope" class="table-of-contents__link toc-highlight">时域：声音包络（Envelope）</a></li><li><a href="#频域声音频谱spectrum" class="table-of-contents__link toc-highlight">频域：声音频谱（Spectrum）</a></li><li><a href="#时域与频域声音时频谱spectrogram" class="table-of-contents__link toc-highlight">时域与频域：声音时频谱（Spectrogram）</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>